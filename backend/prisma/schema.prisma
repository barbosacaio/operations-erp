generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

model User {
    id String @id @default(uuid())
    name String
    surname String
    email String @unique
    passwordHash String
    createdAt DateTime @default(now())

    workspaces WorkspaceUser[]
}

model Workspace {
    id String @id @default(uuid())
    name String
    createdAt DateTime @default(now())

    users WorkspaceUser[]
    departments Department[]
    invoices Invoice[]
}

model WorkspaceUser {
    id String @id @default(uuid())
    userId String
    workspaceId String
    departmentId String?
    role WorkspaceRole @default(MEMBER)
    joinedAt DateTime @default(now())

    tasks Task[]

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)
    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
    department Department? @relation(fields: [departmentId], references: [id])

    @@unique([userId, workspaceId])
}

enum WorkspaceRole {
    OWNER
    ADMIN
    MEMBER
}

model Department {
    id String @id @default(uuid())
    name String
    workspaceId String
    createdAt DateTime @default(now())

    users WorkspaceUser[]
    projects Project[]

    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
}

model Project {
    id String @id @default(uuid())
    name String
    description String
    departmentId String
    createdAt DateTime @default(now())
    status ProjectStatus @default(BACKLOG)

    tasks Task[]

    department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
}

enum ProjectStatus {
    BACKLOG
    ONGOING
    PAUSED
    FINISHED
    CANCELLED
}

model Task {
    id String @id @default(uuid())
    name String
    description String
    assigneeId String?
    projectId String
    dueDate DateTime?
    priority TaskPriority @default(MEDIUM)
    status TaskStatus @default(BACKLOG)

    assignee WorkspaceUser? @relation(fields: [assigneeId], references: [id], onDelete: Cascade)
    project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

enum TaskPriority {
    LOW
    MEDIUM
    HIGH
    CRITICAL
}

enum TaskStatus {
    BACKLOG
    ONGOING
    PAUSED
    FINISHED
    CANCELLED
}

model Invoice {
    id String @id @default(uuid())
    type InvoiceType
    value Int
    target InvoiceTarget?
    status InvoiceStatus @default(UNPAID)
    dueDate DateTime?
    paidDate DateTime?
    workspaceId String

    workspace Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
}

enum InvoiceType {
    EXPENSE
    INCOME
}

enum InvoiceTarget {
    AFFILIATE
    CONTRACTOR
    CUSTOMER
    EMPLOYEE
    PARTNER
    SUBSIDIARY
    SUPPLIER
    TAX
    VENDOR
}

enum InvoiceStatus {
    UNPAID
    PAID
    EXPIRED
    CANCELLED
}